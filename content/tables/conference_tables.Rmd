```{r setup}
library(gt)
library(gtExtras)
library(dplyr, warn.conflicts =  FALSE)
library(ggplot2)
library(magrittr)
```

The following code then imports the data from Gary, then calculate points difference and total points scored

```{r import}
league_dat <- data.frame(read.csv('round1.csv'))
# calculate points difference and total points
league_dat$Pts.Diff <- league_dat$Points.Scored - league_dat$Points.Conceded
league_dat$Bonus.Points <- league_dat$Bonus.Points..Losing. +
                           league_dat$Bonus.Points..Try.
league_dat <- select(league_dat, -6, -7)
league_dat$Points <- league_dat$Wins*4 +
                     league_dat$Draws*2 + 
                     league_dat$Bonus.Points
# create form variable
form <- list(c(0),
             c(1),
             c(1),
             c(0),
             c(0),
             c(1),
             c(1),
             c(1),
             c(0),
             c(0),
             c(0),
             c(1))

league_dat$Form <- form
# order the league table based on total number of points then 
table <- league_dat %>%
  group_by(league_dat$Conf) %>%
  arrange(league_dat$Conf, -league_dat$Points, 
          -league_dat$Pts.Diff,
          league_dat$Team) %>%
  mutate(Rank = 1:n()) %>%
  gt() %>%
  gt_plt_winloss(Form,
                 palette = c("green","red","black")) %>%
  cols_move_to_start(columns = c(Rank, Team)) %>%
  cols_move(
    columns = Form,
    after = Pts.Diff
  ) %>%
  cols_hide(columns = c(Conf)) %>%
  cols_label(
    Team = md("**Team**"),
    Conf = md("**Conference**"),
    Wins = md("**W**"),
    Draws = md("**D**"),
    Losses = md("**L**"),
    Bonus.Points = md("**BP**"),
    Points.Scored = md("**For**"),
    Points.Conceded = md("**Against**"),
    Pts.Diff = md("**Diff**"),
    Points = md("**Pts**"),
    Rank = md("**Rank**"),
    Form = md("**Form**")
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "red", alpha = 0.2),
      cell_text(color = "black")
      ),
    locations = cells_body(rows = Rank > 4)
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "green", alpha = 0.2),
      cell_text(color = "black")
      ),
    locations = cells_body(rows = Rank < 5)
  ) %>%
    tab_footnote(
    footnote = "1 win = 4 points",
    locations = cells_column_labels(columns = Wins)
  ) %>%
    tab_footnote(
    footnote = "1 draw = 2 points",
    locations = cells_column_labels(columns = Draws)
  ) %>%
    tab_footnote(
    footnote = "1 bonus point for scoring 4 or more tries and/or losing within 7 points",
    locations = cells_column_labels(columns = Bonus.Points)
  ) %>%
    tab_footnote(
    footnote = "Positions based on points scored, points difference, scored and then conceded in that order",
    locations = cells_column_labels(columns = Rank)
  ) %>%
   gt_add_divider(columns = Team, color = "grey", style = "solid") %>%
  cols_align(align = ("center"),
  columns = Form)
table

# gtExtras::gt_plt_winloss(outcomes, max_wins = 16, type = "pill") %>%

```

